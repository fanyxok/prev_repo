# 简介

基于 `github` 上的 `CPCA` 项目修改

一个用于提取简体中文字符串中省，市和区(一二三级行政区)并能够进行映射，检验，统计的python程序



可以分析的输入格式：

```c
P=一级行政区
C=二级行政区
A=三级行政区
L=任意字符
ws=白空格

输入：S=(L*(ws* P ws* C ws* A ws*)*L*)*
输出：S中的所有PCA字段中的P,C,A以及频数统计
```



举个例子：

```python
输入：["陕西省宝鸡市眉县首善街道首善镇平阳街30号眉县供电分公司",
"吉林省 延边朝鲜族自治州 安图县 一条街老健委家属楼一单元302",
"重庆重庆市沙坪坝区沙坪坝康居西城六组团菜鸟驿站",
"内蒙古自治区呼和浩特市赛罕区丰州路玉锦轩",
"山东省烟台市福山区山东省烟台市开发区嵛景华城小区4号楼1150"]

输出：
省{陕西省：1, 吉林省: 1,重庆: 1,内蒙古自治区: 1,山东省: 1}
市{宝鸡市: 1,延边朝鲜族自治州: 1,重庆市: 1,呼和浩特市: 1,烟台市: 1}
区{眉县: 1,安图县: 1,沙坪坝区: 1,赛罕区: 1,福山区:1}
```



鲁棒性：

```python
#一段字符中有多个地址
输入：["陕西省西安市未央区太元路中建开元壹号西门麻烦到陕西省西安市雁塔区艺术大街北段紫薇田园都市d区5号楼2单元"]

输出：
省{陕西省: 2}
市{西安市: 2}
区{未央区: 1, 雁塔区: 1}
```

```python
#一段地址中街道字段出现省市区单位
输入: ["上海上海市浦东新区上海市浦东新区沪城环路999号上海海洋大学本科生近邻宝"]
    
输出：
省{上海: 1}
市{上海市: 1}
区{浦东新区: 1}
```



如果觉得本模块对你有用的话，施舍个star，谢谢。

# 中国三级行政区划分（爬取自[中华人民共和国民政局全国行政区划查询平台](http://xzqh.mca.gov.cn/map)）

数据文件在为[cpca/resources/pca.csv](https://github.com/DQinYuan/chinese_province_city_area_mapper/blob/master/cpca/resources/pca.csv)，数据为2019年2月20日在官网上爬取的最新权威数据

# Get Started

本模块中最主要的方法是`cpca.transform`，该方法可以输入任意的可迭代类型（如list，pandas的Series类型等）

```python
location_str = ["陕西省宝鸡市眉县首善街道首善镇平阳街30号眉县供电分公司",
"吉林省 延边朝鲜族自治州 安图县 一条街老健委家属楼一单元302",
"重庆重庆市沙坪坝区沙坪坝康居西城六组团菜鸟驿站"]
import cpca
df = cpca.transform(location_str)
df.show()
```


输出的结果为：

    省{陕西省：1, 吉林省: 1,重庆: 1}
    市{宝鸡市: 1,延边朝鲜族自治州: 1,重庆市: 1}
    区{眉县: 1,安图县: 1,沙坪坝区: 1}

> 注：程序输出的df是一个Pca类型的实例，包含province, city, area 三个dict({name: frequency})属性和show()函数
>

如果你想获知程序是从字符串的那个位置提取出省市区名的，可以添加一个`pos_sensitive=True`参数：

```python
location_str = ["陕西省宝鸡市眉县首善街道首善镇平阳街30号眉县供电分公司",
"吉林省 延边朝鲜族自治州 安图县 一条街老健委家属楼一单元302",
"重庆重庆市沙坪坝区沙坪坝康居西城六组团菜鸟驿站"]
import cpca
df = cpca.transform(location_str, pos_sensitive=True)
df
```

输出如下：

```
to be done
```

其中`省_pos`，`市_pos`和`区_pos`三列大于-1的部分就代表提取的位置。-1则表明这个字段是靠程序推断出来的，抑或没能提取出来。



看看下面一个例子：

```python
location_str = ["江苏省鼓楼区软件大道89号"]
import cpca
df = cpca.transform(location_str)
df
```

输出结果为：

```
   省      市   区      地址
0  江苏省       鼓楼区  软件大道89号
```

可以看到，市没有被成功提取出来，并且还会产生一个警告信息：

```
WARNING:root:鼓楼区 无法映射, 建议添加进umap中
```

> 如果想要关闭这个警告信息,可以在调用transform函数时将open_warning置位False

当程序发现重名区并且不知道将其映射到哪一个市时，会将其加入警告信息，
提示用户最好根据数据给它指定一个市进行映射。

这里无法提取的原因是江苏省南京市有一个鼓楼区，江苏省徐州市也有一个鼓楼区，
程序无法知道这个鼓楼区是南京市的还是徐州市的。

通过数据接口你可以发现这个事实：

```python
import cpca
cpca.province_area_map.get_relational_addrs(('江苏省', '鼓楼区'))
```

输出：

```python
[('江苏省', '南京市', '鼓楼区'), ('江苏省', '徐州市', '鼓楼区')]
```

如果你想要让“鼓楼区”只映射到南京市的话，在`transform`方法中加入`umap`参数指定
映射即可：

```python
location_str = ["江苏省鼓楼区软件大道89号"]
import cpca
df = cpca.transform(location_str, umap={"鼓楼区":"南京市"})
df
```

输出结果：

```     
   省      市      区      地址
0  江苏省  南京市  鼓楼区  软件大道89号`
```
